---
title: "GeneOnt"
output: html_document
date: "2024-12-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
# if (!require("BiocManager", quietly = TRUE))
#     install.packages("BiocManager")
# 
# BiocManager::install("DESeq2")
#install.packages("fastmap")

#BiocManager::install("clusterProfiler")
#BiocManager::install("org.Hs.eg.db")
#BiocManager::install("AnnotationDbi")

#install.packages("org.Hs.eg.db")
library(dplyr)
library(ggplot2)
library(DESeq2)
library(clusterProfiler)
library(org.Hs.eg.db)
library(AnnotationDbi)
library(clusterProfiler)
library(pheatmap)
library(stringr)


gene_template <- read_excel("/Users/dylan/Documents/CRISPR Screen data/WT/WT_CRISPR_finalAnalysis.xlsx", sheet = "Raw_Data")

#USE MODIFIED-Z SCORE!! 
#Counts$Z_Score <- ((Counts$Corrected_BScore - mean(Counts$Corrected_BScore)) /mad(Counts$Corrected_BScore))

CountsX <- gene_template[which(gene_template$Z_Score > 2),]

#Filter for only targets predicted to interact directly with targets (no results for Zinc)
#Counts <- Counts[which(Counts$Interactor == "triterpene" | Counts$Interactor == "disulfiram" | Counts$Interactor == "plumbagin",),]
#For chemical screen
#genes_to_test <- Counts[[1]]
#For CRISPR Screen
genes_to_test <- CountsX[[3]]

# Example enrichGO analysis
enriched <- enrichGO(
    gene = genes_to_test,
    OrgDb = org.Hs.eg.db,
    keyType = "SYMBOL",
    ont = "BP",  # Biological Process
   # pAdjustMethod = "BH",
    pvalueCutoff = 0.05
)

# Extract GO results

go_results <- as.data.frame(enriched[1:20])

go_results

#go_results <- go_results[which(go_results$qvalue < 0.1),]

# Create a gene-term matrix based on p-value

genes <- unique(unlist(strsplit(go_results$geneID, "/")))
go_terms <- go_results$Description


#go_terms3 <- go_terms3[1:20]
# Initialize matrix for p-values
gene_term_matrix <- matrix(NA, nrow = length(go_terms), ncol = length(genes),
                           dimnames = list(go_terms, genes))

# Populate matrix with -log10(p-value) for visualization
for (i in seq_along(go_terms)) {
    term_genes <- unlist(strsplit(go_results$geneID[i], "/"))
    p_value <- go_results$p.adjust[i]
    gene_term_matrix[go_terms[i], term_genes] <- -log10(p_value)  # Use -log10(p-value)
}

# Replace NA with 0 for better visualization
gene_term_matrix[is.na(gene_term_matrix)] <- 0

#For Genomic Screen
annotation <- data.frame(Z_Score = Counts$Z_Score[match(colnames(gene_term_matrix), Counts[[3]])])

rownames(annotation) <- colnames(gene_term_matrix)


phmap <- pheatmap(
  
    gene_term_matrix,
    cluster_rows = TRUE,
    cluster_cols = TRUE,
    show_rownames = TRUE,
    show_colnames = TRUE,
    
    annotation_col = annotation,


    color = colorRampPalette(c("gray92", "darkred"))(50),
    border_color = "black",
    fontsize = 16,               # General font size
  fontsize_row = 18,           # Font size for row labels
  fontsize_col = 18,
  cutree_rows = 8, cutree_cols = 27,

)

ggsave("/Users/dylan/Documents/papers_grants_other/SmallMoleculeNuclearCondensates/GO_BPHeatMapWTScreen.png", phmap, dpi = 300, width = 30, height = 16)

library(heatmaply)

# Create the heatmaply object
heatmap_plot <- heatmaply(
  (gene_term_matrix), 
  Rowv = phmap[[1]], #To keep the rows/columns ordered in the same arrangement to that of phmap
  Colv = phmap[[2]], 
  #k_col = 2, 
  k_row = 3, 
  fontsize_row = 5, 
  fontsize_col = 6, 
  col_side_colors = annotation, 
  xlab = NULL, 
  ylab = NULL, 
  margins = c(1, 1, 1, 1),
  plot_width = 2000, 
  plot_height = 800, 
  color = colorRampPalette(c("gray92", "darkred"))(50),

  file = "/Users/dylan/Documents/CRISPR Screen data/WT/InteractiveHeatmap.html",

)

# Plot the top 30 categories
go_results


GOPlot1 <- plot(barplot(enriched, showCategory = 20, title = "Top 20 GO Terms - Genetic Screen:"), )+  theme(plot.title = element_text(size = 20)) 

ggsave("/Users/dylan/Documents/CRISPR Screen data/WT/GO_barPlotWTScreen.png", GOPlot1, dpi = 300, width = 10, height = 15)

genes
```


```{r}

Counts2 <- read.delim("/Users/dylan/Documents/CRISPR Screen data/WT/StitchResults.csv", 
                     header = TRUE, sep = ",")

#Filter for only targets predicted to interact directly with targets (no results for Zinc)
Counts2 <- Counts2[which(Counts2$Interactor == "triterpene" | Counts2$Interactor == "disulfiram" | Counts2$Interactor == "plumbagin",),]
#For chemical screen
genes_to_test2 <- Counts2[[1]]

# Example enrichGO analysis
enriched2 <- enrichGO(
    gene = genes_to_test2,
    OrgDb = org.Hs.eg.db,
    keyType = "SYMBOL",
    ont = "BP",  # Biological Process
    pAdjustMethod = "BH",
    qvalueCutoff = 0.05
)

# Extract GO results


go_results2 <- as.data.frame(enriched2[1:20])
go_results2

# Create a gene-term matrix based on p-value

genes2 <- unique(unlist(strsplit(go_results2$geneID, "/")))
go_terms2 <- go_results2$Description

go_terms2 <- go_terms2[1:20]
# Initialize matrix for p-values
gene_term_matrix2 <- matrix(NA, nrow = length(go_terms2), ncol = length(genes2),
                           dimnames = list(go_terms2, genes2))

# Populate matrix with -log10(p-value) for visualization
for (i in seq_along(go_terms2)) {
    term_genes <- unlist(strsplit(go_results2$geneID[i], "/"))
    p_value <- go_results2$p.adjust[i]
    gene_term_matrix2[go_terms2[i], term_genes] <- -log10(p_value)  # Use -log10(p-value)
}



# Replace NA with 0 for better visualization
gene_term_matrix2[is.na(gene_term_matrix2)] <- 0

Counts2 <- Counts2 %>%
    mutate_all(funs(str_replace(., "disulfiram", "Disulfiram"))) %>%
    mutate_all(funs(str_replace(., "triterpene", "Celastrol"))) %>%
    mutate_all(funs(str_replace(., "plumbagin", "Plumbagin")))

#For chemical screen
annotation2 <- data.frame(Drug = Counts2$Interactor[match(colnames(gene_term_matrix2), Counts2[[1]])])
rownames(annotation2) <- colnames(gene_term_matrix2)

# phmap2 <- pheatmap(
#   
#     gene_term_matrix2,
#     cluster_rows = TRUE,
#     cluster_cols = TRUE,
#     show_rownames = TRUE,
#     show_colnames = TRUE,
#     main = "Enriched GO Biological Process from Predicted Targets of Chemical Screen",
#     
#     annotation_col = annotation2,
# 
#     color = colorRampPalette(c("white", "red"))(50),
#     border_color = NA,
#     fontsize = 14,               # General font size
#   fontsize_row = 15,           # Font size for row labels
#   fontsize_col = 13,      
# )
# 
# 
# phmap2 + 
#   theme(
#     plot.title = element_text(size = 18, face = "bold"),
#     legend.text = element_text(15),
#     theme(title = element_text(size = 32, face = "bold")) +
#     theme(axis.title.x = element_text(size = 60, face = "bold")))

library(grid)

phmap2 <- pheatmap(
  
    gene_term_matrix2,
    cluster_rows = TRUE,
    cluster_cols = TRUE,
    show_rownames = TRUE,
    show_colnames = TRUE,
    main = " " ,
    
    annotation_col = annotation2,

    color = colorRampPalette(c("gray92", "darkred"))(50),
    #border_color = "red",
    fontsize = 16,               # General font size
  fontsize_row = 22,           # Font size for row labels
  fontsize_col = 24,
  cutree_rows = 10, cutree_cols = 10,

)

# 
# phmap2 +
#   theme(
#     plot.title = element_text(size = 18, face = "bold"),
#     legend.text = element_text(12, face = "bold"),
#     theme(title = element_text(size = 32, face = "bold")) +
#     theme(axis.title.x = element_text(size = 60, face = "bold")))


ggsave("/Users/dylan/Documents/papers_grants_other/SmallMoleculeNuclearCondensates/GO_BPHeatMapPharmakonScreen2.png", phmap2, dpi = 300, width = 20, height = 24)


library(heatmaply)

# Create the heatmaply object
heatmap_plot <- heatmaply(
  (gene_term_matrix2), 
  Rowv = phmap2[[1]], #To keep the rows/columns ordered in the same arrangement to that of phmap
  Colv = phmap2[[2]], 
  #k_col = 2, 
  k_row = 3, 
  fontsize_row = 8, 
  fontsize_col = 10, 
  col_side_colors = annotation2, 
  xlab = NULL, 
  ylab = NULL, 
  margins = c(1, 1, 1, 1),
  plot_width = 2000, 
  plot_height = 800, 
  color = colorRampPalette(c("gray92", "darkred"))(50),

  file = "/Users/dylan/Documents/papers_grants_other/SmallMoleculeNuclearCondensates/PharmakonInteractiveHeatmap.html",

)





go_results2 <- as.data.frame(enriched2@result)
go_results2 <- as.data.frame(enriched2[1:20])

# Plot the top 30 categories
go_results2

GOPlot2 <- plot(barplot(enriched2, showCategory = 20, title = "Top 20 GO Terms - Chemical Screen:")) +  theme(plot.title = element_text(size = 20)) 

ggsave("/Users/dylan/Documents/CRISPR Screen data/WT/GO_barPlotPharmakonScreen.png", GOPlot2, dpi = 300, width = 10, height = 14)


go_terms
go_terms2

genes
genes2

for (i in 1:length(go_terms2)){
  if(go_terms2[i]  %in% go_terms){
    print(go_terms2[i])
  }
}



for (i in 1:length(genes2)){
  if(genes2[i]  %in% genes){
    print(genes2[i])
  }
}

# 
# Genes overlapping:
# [1] "SRC"
# [1] "HSP90AA1"
# 
# BP overlapping:
# [1] "response to heat"
# [1] "response to temperature stimulus"
# [1] "response to reactive oxygen species"

#GeneRatio (k/n): "ratio of input genes that are annotated in a term." (# of genes in the input list that are annotated to the corresponding term (function) / # of genes in input list).

#BgRatio (M/N): "ratio of all genes that are annotated in this term" (The number of genes that are annotated to the term / The total number of genes in the background gene list #("universe")).

```

```{r}

# Identify xunique gene names from both matrices
genes_matrix1 <- colnames(gene_term_matrix)
genes_matrix2 <- colnames(gene_term_matrix2)

genes_matrix1 <- colnames(gene_term_matrix)
genes_matrix2 <- colnames(gene_term_matrix2)

venn_data <- list(
    "Genetic Screen Hits" = genes_matrix1,
     "Predicted Targets from Chemical Screen" = genes_matrix2
)
library(ggvenn)
# Create the Venn diagram
ggvenn_plot <- ggvenn(
    venn_data, 
    fill_color = c("darkred", "green"),
    stroke_size = 0.5,
    set_name_size = 5,
    show_percentage = TRUE,
    text_size = 7 # This will show the percentages inside the Venn diagram
)

# Extract the overlap genes
overlap_genes <- intersect(genes_matrix1, genes_matrix2)


genes_matrixPath1 <- rownames(gene_term_matrix)
genes_matrixPath2 <- rownames(gene_term_matrix2)

venn_data_pathways <- list(
    "Enriched GO Pathways (Genetic Screen)" = genes_matrixPath1,
    "Enriched GO Pathways (Chemical Screen)" = genes_matrixPath2
)

# Create the Venn diagram
ggvenn_plot_Path <- ggvenn(
    venn_data_pathways, 
    fill_color = c("darkred", "green"),
    stroke_size = 0.5,
    set_name_size = 5,
    show_percentage = TRUE,
    text_size = 7 
    # This will show the percentages inside the Venn diagram
) 

# Extract the overlap genes 
overlap_genes <- intersect(genes_matrixPath1, genes_matrixPath2)


ggsave("/Users/dylan/Documents/CRISPR Screen data/WT/VennGeneOverlap.png", ggvenn_plot, dpi = 300, width = 10, height = 15)
ggsave("/Users/dylan/Documents/CRISPR Screen data/WT/VennPathOverlap.png", ggvenn_plot_Path, dpi = 300, width = 10, height = 15)

```


```{r}


# Identify unique gene names from both matrices
genes_matrix1 <- colnames(gene_term_matrix)
genes_matrix2 <- colnames(gene_term_matrix2)

# Identify overlapping and unique genes
overlap_genes <- intersect(genes_matrix1, genes_matrix2)
unique_matrix1 <- setdiff(genes_matrix1, overlap_genes)
unique_matrix2 <- setdiff(genes_matrix2, overlap_genes)

combined_genes <- c(genes_matrix1, genes_matrix2)

combined_genes <- unique(combined_genes)


allgenes <- read.delim("/Users/dylan/Documents/CRISPR Screen data/WT/WTRawData.csv", 
                     header = TRUE, sep = ",")

bscore_vector2 <- allgenes$BScore[match(genes_matrix2, allgenes$Gene)]



# Step 4: Fill the matrix with BScore values
# Now, populate the matrix with BScore for each gene in both rows and columns
for (i in seq_along(combined_genes)) {
    gene <- combined_genes[i]
    gene_term_matrix3[gene, ] <- bscore_vector[i]
    gene_term_matrix3[, gene] <- bscore_vector[i]
}

# The matrix is now filled with the BScore values corresponding to each gene
print(gene_term_matrix3)
gene_term_matrix3 <- matrix(NA, nrow = length(combined_genes), ncol = length(combined_genes),
                           dimnames = list(combined_genes, combined_genes))





correlation_matrix[is.na(correlation_matrix)] <- 0

correlation_matrix <- cor(t(gene_term_matrix3), method = "pearson")



pheatmap(
  gene_term_matrix3,
  main = "Correlation Between Gene-Term Matrices",
  color = colorRampPalette(c("blue", "white", "red"))(50),
  cluster_rows = TRUE,
  cluster_cols = TRUE,
  border_color = NA
)



Counts <- read.delim("/Users/dylan/Documents/CRISPR Screen data/WT/WTRawData.csv", 
                     header = TRUE, sep = ",")
#Counts <- Counts[which(Counts$Z_Score > 3),]

Counts


Counts$Z_Score <- ((Counts$BScore - mean(Counts$BScore)) /sd(Counts$BScore))
  
  
merged_Df_NoCtrls_noNA <- merged_Df_NoCtrls[complete.cases(merged_Df_NoCtrls),]
merged_Df_NoCtrls$Z_Score <-  ((merged_Df_NoCtrls$Corrected_BScore - mean(merged_Df_NoCtrls_noNA$Corrected_BScore)) / sd(merged_Df_NoCtrls_noNA$Corrected_BScore))
merged_Df_NoCtrls$Z_Score <- round(merged_Df_NoCtrls$Z_Score, 2)


mad(Counts$Corrected_BScore)
sd(Counts$BScore)
```


```{r}

# 
# #Genome Screen
# gene_template <- read.delim("/Users/dylan/Documents/CRISPR Screen data/WT/WTRawData.csv", 
#                      header = TRUE, sep = ",")
# gene_template <- Counts
# normalized_Sd_Bar <- ggplot(data = gene_template, aes(x=paste0(Well_Condition, Plate), y = Z_Score, fill = factor(ifelse(Z_Score >= 3, "tofill", "nottofill")))) +
#   geom_point(data = filter(gene_template, Z_Score >= 4),
#                aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = Z_Score , yend = Z_Score),
#                color = "red", size = 2) +
#   geom_point(data = filter(gene_template, Z_Score < 4),
#                aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = Z_Score, yend = Z_Score),
#                color = "black", size =0.1, position = position_jitter(width = 0.3, height = 0), alpha = 0.5)+
#   geom_point(data = filter(gene_template, Gene == "TOR1A" | Gene == "TOR1B"),
#                aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = Z_Score, yend = Z_Score),
#                color = "green", size = 3 )+
#    # geom_segment(data = filter(merged_Df_NoCtrls, Gene == "MLF2"),
#    #             aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = 0, yend = Z_Score),
#    #             color = "purple", size =1 )+
#    # geom_segment(data = filter(merged_Df_NoCtrls, Gene == "OR5D18" | Gene == "POLR2I" |Gene ==  "POLR2A"),
#    #             aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = 0, yend = Z_Score),
#    #             color = "gray", size =1 )+
#    
#       scale_fill_manual(values = c("tofill" = "red", "nottofill" ="gray27")) +
# 
#    theme_classic() +
#    theme(axis.title.x=element_blank(),
#          axis.text.x=element_blank(),
#          axis.ticks.x=element_blank(),) +
# # #Edit title as needed
# # #------------------------------------------------------------------
#    labs(y = "Z-Score", x = "sgRNA", title = "Genome-Wide CRISPR Screen Hits:") +
# # #------------------------------------------------------------------
# #
#   scale_y_continuous(limits = c(-10, -5, -3, 0, 3, 5, 10)) +
#   scale_y_continuous(breaks=c( -10, -8, -6, -4, -2, 0, 2, 4,6,8,10)) +
#   geom_hline(yintercept = c(2), color = "darkred", linetype = "dashed", size = 0.5) +
#   geom_text_repel(data = filter(gene_template, Z_Score >= 4 |Gene == "TOR1A" | Gene == "TOR1B"  ), aes(label = paste0(Gene)), box.padding = 0.2, size = 3, max.overlaps = Inf) +
#   guides(fill="none")+
#   theme(plot.title = element_text(size = 18)) +
#   theme(axis.title = element_text(size = 18)) +
#   coord_cartesian(ylim = c(-10, 10))
# 
# normalized_Sd_Bar
# ggsave("/Users/dylan/Documents/CRISPR Screen data/WT/WTNormalizedZScore.png", normalized_Sd_Bar, dpi = 300, width = 10, height = 10)
# 

head(gene_template)
```


```{r}
library(readxl)
library(ggrepel)
#Pharmakon Screen
gene_template <- read_excel("/Users/dylan/Documents/Analyzed_Data_dp/DP/Pharmakon_Screen/Pharmakon_2h_1.xlsx", sheet = "Raw_Data")

#USE MODIFIED-Z SCORE!! 
#gene_template$Z_Score <- ((gene_template$Corrected_BScore - mean(gene_template$Corrected_BScore)) / mad(gene_template$Corrected_BScore))
gene_template <- gene_template[gene_template$Compound != "NA",]

normalized_Sd_Bar <- ggplot(data = gene_template, aes(x=paste0(Well_Condition, Plate), y = Z_Score, fill = factor(ifelse(Z_Score >= 3, "tofill", "nottofill")))) +
  geom_point(data = filter(gene_template, Z_Score >= 3),
               aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = Z_Score , yend = Z_Score),
               color = "blue", size = 2.25) +
  geom_point(data = filter(gene_template, Z_Score < 3),
               aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = Z_Score, yend = Z_Score),
               color = "black", size =1, position = position_jitter(width = 0.3, height = 0), alpha = 0.4)+
  geom_point(data = filter(gene_template, Compound == "PLUMBAGIN" | Compound == "CELASTROL" | Compound == "PYRITHIONE ZINC" | Compound == "DISULFIRAM"),
               aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = Z_Score, yend = Z_Score),
               color = "red", size = 4 )+
  
   # geom_segment(data = filter(merged_Df_NoCtrls, Gene == "MLF2"),
   #             aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = 0, yend = Z_Score),
   #             color = "purple", size =1 )+
   # geom_segment(data = filter(merged_Df_NoCtrls, Gene == "OR5D18" | Gene == "POLR2I" |Gene ==  "POLR2A"),
   #             aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = 0, yend = Z_Score),
   #             color = "gray", size =1 )+
   
      scale_fill_manual(values = c("tofill" = "red", "nottofill" ="black")) +

   theme_classic() +
   theme(axis.title.x=element_blank(),
         axis.text.x=element_blank(),
         axis.ticks.x=element_blank(),
          axis.text.y = element_text(size = 18, face = "bold"), # Increase y-axis label size
    axis.title.y = element_text(size = 24, face = "bold") # Adjust axis title size if needed
  ) +
# #Edit title as needed
# #------------------------------------------------------------------
   labs(y = "Z-Score", x = "Drugs", title = NULL) +
# #------------------------------------------------------------------
#
  scale_y_continuous(limits = c(-10, -5, -3, 0, 3, 5, 8)) +
  scale_y_continuous(breaks=c( -10, -8, -6, -4, -2, 0, 2, 4,6,8)) +
  geom_hline(yintercept = c(3), color = "darkred", linetype = "dashed", size = 0.5) +
  geom_text_repel(data = filter(gene_template, Z_Score >= 3 & Compound != "PLUMBAGIN" & Compound != "CELASTROL" & Compound != "PYRITHIONE ZINC" & Compound != "DISULFIRAM"), aes(label = paste0(Compound)), box.padding = 0.5, size = 4, max.overlaps = Inf, fontface = "bold") +
  geom_text_repel(data = filter(gene_template, Compound == "PLUMBAGIN" | Compound == "CELASTROL"| Compound == "PYRITHIONE ZINC" | Compound == "DISULFIRAM"), aes(label = paste0(Compound)), box.padding = 2, size = 5, max.overlaps = Inf, fontface = "bold", color = "red") +

  
  guides(fill="none")+
  
  theme(plot.title = element_text(size = 18)) +
  theme(axis.title = element_text(size = 24, face = "bold")) +
  coord_cartesian(ylim = c(-2.5, 9))

normalized_Sd_Bar
ggsave("/Users/dylan/Documents/Analyzed_Data_dp/DP/Pharmakon_Screen/Pharmakon17602hV2.tif", normalized_Sd_Bar, dpi = 300, width = 10, height = 10)
ggsave("/Users/dylan/Documents/papers_grants_other/SmallMoleculeNuclearCondensates/Pharmakon1760ZScore.pdf", normalized_Sd_Bar, dpi = 300, width = 10, height = 10)

head(gene_template)
```

```{r}
# save_Location <- "C:/Users/Schlieker Lab/Desktop/Old_Backedup_Data_prior_to_23_11_17/Dylan/Compound Screen/pilot_screen_9_1_23_dp/pilot_6h_results.xlsx"
# wb <- loadWorkbook(gene_template)
 
merged_Df_NoCtrls <- gene_template
merged_Df_NoCtrls[is.na(merged_Df_NoCtrls$Plate) == FALSE,]


#FOR Pharmakon ANALYSIS
raw_Distribution <- ggplot(merged_Df_NoCtrls, aes(x = Average_foci_perCell )) +
  geom_histogram(color = "black", fill = "darkred", binwidth = 0.3) +
  geom_density(alpha = 0.6, fill = "darkred" ) +
  labs(title = NULL,  y = "Count", x = "MLF2-GFP Foci/Cell") +
  theme_classic() +
  theme(title = element_text(size = 40, face = "bold")) +
  theme(axis.title.x = element_text(size = 37, face = "bold")) +
  theme(axis.text.y = element_text(size = 30, face = "bold"), # Increase y-axis label size
    axis.text.x = element_text(size = 30, face = "bold"),
     axis.ticks.length = unit(0.4, "cm"), # Increase tick length
    axis.ticks = element_line(size = 1.2) # Increase tick thickness# Adjust axis title size if needed
  ) 


#FOR Pharmakon
normalized_Dist <- ggplot(merged_Df_NoCtrls, aes(x = Normalized_Effect)) +
  geom_histogram(color = "black", fill = "darkred", binwidth = 1) +
  geom_density(alpha = 0.6, fill = "darkgray" ) +

  geom_vline(aes(xintercept = 100), linetype = 'dashed', size = 2) +
  annotate("text", x=90, y=50, label="WT HeLa", angle=90, size = 12) +
  geom_vline(aes(xintercept = 0), linetype = 'dashed', size = 2) +
  annotate("text", x=-10, y=50, label= "DMSO",  color = "black", angle=90, size = 12) +


  # geom_vline(aes(xintercept = mean_minus_3SD), linetype = 'dashed', color = "red", size = 1) +
  # annotate("text", x=mean_minus_3SD - 4, y=25, label="(-) 3SD", angle=90, size = 5) +

  labs(title = NULL, y = "Count", x = paste("% Decrease in MLF2-GFP Relative to DMSO")) +
  theme_classic() +
   theme(title = element_text(size = 40, face = "bold")) +
  theme(axis.title.x = element_text(size = 37, face = "bold")) +
  theme(axis.text.y = element_text(size = 30, face = "bold"), # Increase y-axis label size
    axis.text.x = element_text(size = 30, face = "bold"),
     axis.ticks.length = unit(0.4, "cm"), # Increase tick length
    axis.ticks = element_line(size = 1.2) # Increase tick thickness# Adjust axis title size if needed
  ) 

library(ggpubr)
image_Save_Location <- "/Users/dylan/Documents/Analyzed_Data_dp/DP/Pharmakon_Screen/"
# #Exports graphs as TIFF files
normalized_Dist
tiff(paste(image_Save_Location, "distrpilot_", ".tiff" ,sep = ""), units="in", width=12, height=10, res=300)
ggarrange(normalized_Dist, heights = c(6, 6))
dev.off()

raw_Distribution
tiff(paste(image_Save_Location, "rawdistrpilot_", ".tiff" ,sep = ""), units="in", width=12, height=10, res=300)
ggarrange(raw_Distribution, heights = c(6, 6))
dev.off()

```

```{r}
library(readxl)
library(ggrepel)
#For CRISPR Screen

gene_template <- read_excel("/Users/dylan/Documents/CRISPR Screen data/WT/WT_CRISPR_finalAnalysis.xlsx", sheet = "Raw_Data")

#USE MODIFIED-Z SCORE!! 
gene_template <- gene_template[gene_template$Gene != "NA",]

normalized_Sd_Bar <- ggplot(data = gene_template, aes(x=paste0(Well_Condition, Plate), y = Z_Score, fill = factor(ifelse(Z_Score >= 3, "tofill", "nottofill")))) +
  geom_point(data = filter(gene_template, Z_Score >= 3),
               aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = Z_Score , yend = Z_Score),
               color = "blue", size = 2.25) +
  geom_point(data = filter(gene_template, Z_Score < 3),
               aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = Z_Score, yend = Z_Score),
               color = "black", size =1, position = position_jitter(width = 0.3, height = 0), alpha = 0.25)+
  geom_point(data = filter(gene_template, Gene == "TOR1A" | Gene == "TOR1B"),
               aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = Z_Score, yend = Z_Score),
               color = "green", size = 5 )+
  geom_point(data = filter(gene_template, Gene ==  "APOL3" | Gene == "ZNF335" | Gene == "RNF26"  | Gene == "RAN"),
               aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = Z_Score, yend = Z_Score),
               color = "red", size = 4 )+
  
  
   # geom_segment(data = filter(merged_Df_NoCtrls, Gene == "MLF2"),
   #             aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = 0, yend = Z_Score),
   #             color = "purple", size =1 )+
   # geom_segment(data = filter(merged_Df_NoCtrls, Gene == "OR5D18" | Gene == "POLR2I" |Gene ==  "POLR2A"),
   #             aes(x = paste0(Well_Condition, Plate), xend = paste0(Well_Condition, Plate), y = 0, yend = Z_Score),
   #             color = "gray", size =1 )+
   
      scale_fill_manual(values = c("tofill" = "red", "nottofill" ="black")) +

   theme_classic() +
   theme(axis.title.x=element_blank(),
         axis.text.x=element_blank(),
         axis.ticks.x=element_blank(),
          axis.text.y = element_text(size = 18, face = "bold"), # Increase y-axis label size
    axis.title.y = element_text(size = 24, face = "bold") # Adjust axis title size if needed
  ) +
# #Edit title as needed
# #------------------------------------------------------------------
   labs(y = "Z-Score", x = "Candidate Genes", title = NULL) +
# #------------------------------------------------------------------
#
  scale_y_continuous(
  limits = c(-10, 15),
  breaks = c(-10, -8, -6, -4, -2, 0, 2, 4, 6, 8, 10)
) +
  geom_hline(yintercept = c(2), color = "darkred", linetype = "dashed", size = 0.5) +
  
  geom_text_repel(data = filter(gene_template, Z_Score >= 3 & Gene != "TOR1A" & Gene != "TOR1B" & Gene !=  "APOL3" & Gene != "ZNF335" & Gene != "RNF26"  & Gene != "RAN" ), aes(label = paste0(Gene)), box.padding = 0.4, size = 3.25, max.overlaps = Inf, fontface = "bold") +
  
  geom_text_repel(data = filter(gene_template, Gene == "TOR1A" | Gene == "TOR1B" |Gene ==  "APOL3" | Gene == "ZNF335" | Gene == "RNF26" | Gene == "RAN" ), aes(label = paste0(Gene)), box.padding = 3.5, size = 8, max.overlaps = Inf, fontface = "bold", color = "red") +


  guides(fill="none")+
  theme(plot.title = element_text(size = 18)) +
  theme(axis.title = element_text(size = 24, face = "bold")) +
  coord_cartesian(ylim = c(0.3,8))

normalized_Sd_Bar
ggsave("/Users/dylan/Documents/papers_grants_other/SmallMoleculeNuclearCondensates/WTCRISPR_ZScore.pdf", normalized_Sd_Bar, dpi = 300, width = 10, height = 10)

head(gene_template)

```


```{r}
#WT Screen Distributions:
gene_template <- read_excel("/Users/dylan/Documents/CRISPR Screen data/WT/WT_CRISPR_finalAnalysis.xlsx", sheet = "Raw_Data")


merged_Df_NoCtrls <- gene_template
merged_Df_NoCtrls[is.na(merged_Df_NoCtrls$Plate) == FALSE,]


#FOR Pharmakon ANALYSIS
raw_Distribution <- ggplot(merged_Df_NoCtrls, aes(x = Average_foci_perCell )) +
  geom_histogram(color = "black", fill = "darkred", binwidth = 0.05) +
  geom_density(alpha = 0.6, fill = "darkred" ) +
  labs(title = NULL,  y = "Count", x = "MLF2-GFP Foci/Cell") +
  theme_classic() +
  theme(title = element_text(size = 40, face = "bold")) +
  theme(axis.title.x = element_text(size = 37, face = "bold")) +
  theme(axis.text.y = element_text(size = 30, face = "bold"), # Increase y-axis label size
    axis.text.x = element_text(size = 40, face = "bold"),
     axis.ticks.length = unit(0.4, "cm"), # Increase tick length
    axis.ticks = element_line(size = 1.2) # Increase tick thickness# Adjust axis title size if needed
  ) 


#FOR Pharmakon
normalized_Dist <- ggplot(merged_Df_NoCtrls, aes(x = Normalized_Effect)) +
  geom_histogram(color = "black", fill = "darkred", binwidth = 0.5) +
  geom_density(alpha = 0.6, fill = "darkgray" ) +

  geom_vline(aes(xintercept = 100), linetype = 'dashed', size = 2) +
  annotate("text", x=90, y=600, label="Tor1A/Tor1B sgRNA", angle=90, size = 12) +
  geom_vline(aes(xintercept = 0), linetype = 'dashed', size = 2) +
  annotate("text", x=-10, y=600, label= "NT sgRNA Ctrl",  color = "black", angle=90, size = 12) +


  # geom_vline(aes(xintercept = mean_minus_3SD), linetype = 'dashed', color = "red", size = 1) +
  # annotate("text", x=mean_minus_3SD - 4, y=25, label="(-) 3SD", angle=90, size = 5) +

  labs(title = NULL, y = "Count", x = paste("% Increase in MLF2-GFP Relative to NT")) +
  theme_classic() +
   theme(title = element_text(size = 40, face = "bold")) +
  theme(axis.title.x = element_text(size = 37, face = "bold")) +
  theme(axis.text.y = element_text(size = 30, face = "bold"), # Increase y-axis label size
    axis.text.x = element_text(size = 30, face = "bold"),
     axis.ticks.length = unit(0.4, "cm"), # Increase tick length
    axis.ticks = element_line(size = 1.2) # Increase tick thickness# Adjust axis title size if needed
  ) 

image_Save_Location <- "/Users/dylan/Documents/papers_grants_other/SmallMoleculeNuclearCondensates/"
# #Exports graphs as TIFF files
normalized_Dist
tiff(paste(image_Save_Location, "distrpilot_WTCRISPR", ".tiff" ,sep = ""), units="in", width=12, height=10, res=300)
ggarrange(normalized_Dist, heights = c(6, 6))
dev.off()

raw_Distribution
tiff(paste(image_Save_Location, "rawdistrpilot_WTCRISPR", ".tiff" ,sep = ""), units="in", width=12, height=10, res=300)
ggarrange(raw_Distribution, heights = c(6, 6))
dev.off()
```

